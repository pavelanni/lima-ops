# Rocky Linux 9 Client Template for Lima 1.1+
# MinIO Client with testing tools
# Based on pavelanni/lima_templates

vmType: "vz"
os: "linux"
arch: "aarch64"
images:
- location: "rocky:9"
  arch: "aarch64"
  
minVersion: "1.1.0"

# https://github.com/lima-vm/lima/blob/master/docs/mount.md
mounts:
- location: "~"
  sshfs:
    cache: true
    foldCase: false
- location: "/tmp/lima"
  writable: true

mountType: "sshfs"

disk: "20G"

# Install MinIO client and testing tools
provision:
- mode: system
  script: |
    #!/bin/bash
    set -eux -o pipefail
    export DEBIAN_FRONTEND=noninteractive
    
    # Install base packages
    yum update -y
    yum install -y net-tools vim bc lsof curl wget
    
    # Install MinIO Client (mc)
    curl -fsSL https://dl.min.io/client/mc/release/linux-arm64/mc -o /usr/local/bin/mc
    chmod +x /usr/local/bin/mc
    
    # Install Warp (performance testing tool)
    curl -fsSL https://github.com/minio/warp/releases/latest/download/warp_Linux_arm64.tar.gz | tar xvz -C /tmp
    mv /tmp/warp /usr/local/bin/
    chmod +x /usr/local/bin/warp
    
    # Setup MinIO client configuration directory
    mkdir -p /home/lima/.mc
    chown lima:lima /home/lima/.mc

# Network configuration for Lima 1.1+
networks:
- lima: user-v2

# Resource allocation
cpus: 2
memory: "4GiB"

# SSH configuration
ssh:
  localPort: 0
  forwardAgent: false
  loadDotSSHPubKeys: true

# VirtIO filesystem not supported on vz
mountType.9p: false